<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å§”è¨—è©³æƒ…</title>
    <link rel="stylesheet" href="/css/style.css"> <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>{{project.title}}</h1>
        
        <div style="display: flex; gap: 1rem; flex-wrap: wrap; background: var(--bg-pink-light); padding: 1rem; border-radius: 12px;">
            <span><strong>å§”è¨—äººï¼š</strong> {{ project.client_username }}</span>
            <span><strong>ç™¼å¸ƒæ—¥æœŸï¼š</strong> {{ project.create_time.strftime('%Y-%m-%d') }}</span>
            <span><strong>æˆªæ­¢æ—¥æœŸï¼š</strong> {{ project.deadline_date.strftime('%Y-%m-%d') if project.deadline_date else 'N/A' }}</span>
            <span><span class="status-pill link-{{project.status}}">{{ project.status_text }}</span></span>
        </div>

        {% if project.accepted_freelancer_username %}
            <p style="font-weight: bold; font-size: 1.1rem;"><strong>å·²æ‰¿æ¥ï¼š</strong> {{ project.accepted_freelancer_username }}</p>
        {% endif %}

        <div style="margin: 1.5rem 0; display: flex; gap: 10px;">
            {% if role == 'client' %}
                <a href="/" class="btn btn-secondary">è¿”å›åˆ—è¡¨</a>
                {% if project.status == 'open' or project.status == 'in_progress' %}
                    <a href="/page/edit/{{project.id}}" class="btn btn-primary">ç·¨è¼¯å°ˆæ¡ˆ</a>
                {% endif %}
            {% elif role == 'freelancer' %}
                <a href="/" class="btn btn-secondary">è¿”å›å¸‚å ´</a>
                <a href="/page/my-jobs" class="btn btn-secondary">è¿”å›æˆ‘çš„æ‰¿åŒ…</a>
            {% endif %}
        </div>

        <hr>

        {% if role == 'client' and project.status == 'in_progress' %}
            <div style="background: var(--bg-pink-light); padding: 1rem; border-radius: 12px;">
                <h3>å°ˆæ¡ˆé€²è¡Œä¸­</h3>
                <p>æ‚¨å·²åŒæ„ {{ project.accepted_freelancer_username }} æ¥æ¡ˆï¼Œè«‹ç­‰å€™æ¥æ¡ˆäººäº¤ä»˜æª”æ¡ˆã€‚</p>
            </div>

        {% elif role == 'client' and project.status == 'delivered' %}
            <div style="background: var(--bg-pink-light); padding: 1rem; border-radius: 12px;">
                <h3>çµæ¡ˆç®¡ç†</h3>
                <p>æ¥æ¡ˆäºº ({{ project.accepted_freelancer_username }}) å·²äº¤ä»˜æª”æ¡ˆï¼Œè«‹ä¸‹è¼‰å¯©æ ¸ï¼š</p>
                <a href="/{{ project.delivery_file_path }}" target="_blank" class="btn btn-primary">ä¸‹è¼‰çµæ¡ˆæª”æ¡ˆ</a>
                <div style="margin-top: 1rem; display: flex; gap: 10px;">
                    <a href="/complete-project/{{project.id}}" class="btn btn-primary" style="background-color: var(--status-green);">æ¥å—ä¸¦çµæ¡ˆ</a>
                    <a href="/reject-file/{{project.id}}" class="btn btn-danger">é€€ä»¶</a>
                </div>
            </div>

        {% elif role == 'client' and project.status == 'rejected'%}
            <div style="background: var(--status-red); color: white; padding: 1rem; border-radius: 12px;">
                <h3>å°ˆæ¡ˆå·²é€€ä»¶</h3>
                <p>æ‚¨å·²é€€ä»¶ {{ project.accepted_freelancer_username }} çš„æª”æ¡ˆï¼Œè«‹ç­‰å€™æ¥æ¡ˆäººé‡æ–°äº¤ä»˜ã€‚</p>
            </div>
            
        {% elif role == 'client' and project.status == 'completed'%}
            <div style="background: var(--status-gray); color: white; padding: 1rem; border-radius: 12px;">
                <h3>ğŸ‰ æ­å–œçµæ¡ˆï¼</h3>
                <p>æ¥æ¡ˆäºº ({{ project.accepted_freelancer_username }}) å·²äº¤ä»˜æª”æ¡ˆï¼š</p>
                <a href="/{{ project.delivery_file_path }}" target="_blank" class="btn btn-secondary">ä¸‹è¼‰çµæ¡ˆæª”æ¡ˆ</a>
            </div>
        {% endif %}


        <div>
            <strong>é ç®—ï¼š</strong> <span style="font-size: 1.2rem; font-weight: bold;">${{ project.budget }}</span>
        </div>
        <div>
            <strong>éœ€æ±‚æè¿°ï¼š</strong>
            <p style="line-height: 1.6;">{{ project.content | replace("\n", "<br>") | safe }}</p>
        </div>
        <hr>

        {% if role == 'client' %}
            <h3>æ”¶åˆ°çš„å ±åƒ¹ ({{ bids | length }} å‰‡)</h3>
            {% if bids %}
                <table>
                    <thead>
                        <tr>
                            <th>æ¥æ¡ˆäºº</th>
                            <th>å ±åƒ¹</th>
                            <th>ç•™è¨€</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for bid in bids %}
                        <tr>
                            <td>{{ bid.freelancer_username }}</td>
                            <td>${{ bid.bid_amount }}</td>
                            <td>{{ bid.message }}</td>
                            <td>
                                {% if project.status == 'open' %}
                                    <a href="/bids/accept/{{bid.id}}" class="btn btn-primary" style="padding: 5px 10px;">æ¥å—å ±åƒ¹</a>
                                {% elif bid.status == 'accepted' %}
                                    <span class="status-pill link-open">å·²æ¥å—</span>
                                {% elif bid.status == 'rejected' %}
                                    <span class="status-pill link-rejected">å·²æ‹’çµ•</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>ç›®å‰å°šç„¡å ±åƒ¹ã€‚</p>
            {% endif %}

        {% elif role == 'freelancer' and project.status == 'open'%}
            {% if is_bid_exist == False %}
                <h3>æœ‰æ„é¡˜æ‰¿åŒ…å—ï¼Ÿè«‹æå‡ºæ‰¿åŒ…æ„é¡˜ (å ±åƒ¹)</h3>
                <form id="create-bid-form" action="/submit-bid/{{project.id}}" method="POST">
                    <input type="hidden" name="project_id" value="{{ project.id }}">
                    <div class="form-group">
                        <label for="bid_amount">æ‚¨çš„å ±åƒ¹ (TWD):</label>
                        <input type="number" id="bid_amount" name="bid_amount" required>
                    </div>
                    <div class="form-group">
                        <label for="message">ç•™è¨€ (å‘Šè¨´å§”è¨—äººæ‚¨ç‚ºä»€éº¼é©åˆï¼Œé¸å¡«):</label>
                        <textarea id="message" name="message" rows="4"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">é€å‡ºå ±åƒ¹</button>
                </form>
            {% elif is_bid_exist == True and bid_status == 'pending' %}
                <h3 style="color: var(--status-yellow);">æ‚¨å·²æéå ±åƒ¹ï¼Œè«‹è€å¿ƒç­‰å¾…å§”è¨—äººæ¥å—ã€‚</h3>
            {% elif is_bid_exist == True and bid_status == 'rejected' %}
                <h3 style="color: var(--status-red);">å¾ˆæŠ±æ­‰ï¼Œå§”è¨—äººå·²æ‹’çµ•ä½ çš„å ±åƒ¹ï¼Œå†æ¥å†å²ã€‚</h3>
            {% endif %}

        {% elif role == 'freelancer' and project.status in ['in_progress', 'rejected'] %}
            <h3>
                {% if project.status == 'rejected' %}
                    å§”è¨—äººå·²é€€ä»¶ï¼Œè«‹é‡æ–°ä¸Šå‚³æª”æ¡ˆ
                {% else %}
                    å§”è¨—äººå·²æ¥å—å ±åƒ¹ï¼Œè«‹ä¸Šå‚³çµæ¡ˆæª”æ¡ˆ
                {% endif %}
            </h3>
            <form id="deliver-project-form" action="/deliver-file/{{project.id}}" method="POST" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="delivery_file">é¸æ“‡æª”æ¡ˆ (.zip, .pdf, .jpg...):</label>
                    <input type="file" id="delivery_file" name="delivery_file" required>
                </div>
                <button type="submit" class="btn btn-primary">é€å‡ºæª”æ¡ˆ</button>
            </form>

        {% elif role == 'freelancer' and project.status == 'delivered' %}
            <h3 style="color: var(--status-blue);">æ‚¨å·²ä¸Šå‚³çµæ¡ˆæª”æ¡ˆï¼Œè«‹ç­‰å¾…å§”è¨—äººå¯©æ ¸ã€‚</h3>
            
        {% elif role == 'freelancer' and project.status == 'completed' %}
            <h3 style="color: var(--status-green);">ğŸ‰ æ­å–œï¼å°ˆæ¡ˆå·²çµæ¡ˆã€‚</h3>
        {% endif %}

    </div>
</body>
</html>